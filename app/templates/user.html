<section ng-controller="UserCtrl" class="user">
  <button type="submit" class="user-links-container">
    <a ui-sref="landing" class="navbar-link">Back to main page</a>
  </button>
  <div class="clock">
    <p><b>Time now: {{time | date: 'fullDate'}} at {{time | date: 'mediumTime'}}</b></p>
  </div>
  <div class="list-group">
<!--                            HEADING                               -->

    <div class="row">
      <b>
        <div class="col-sm-1 priorityCell">priority:</div>
        <div class="col-sm-1 nameCell">to do item:</div>
        <div class="col-sm-1 dateCell">date and time due:</div>
        <div class="col-sm-1 importanceCell">importance:</div>
        <div class="col-sm-1 urgentCell">urgent?:</div>
        <div class="col-sm-1 durationCell">duration:</div>
        <div class="col-sm-1 rankCell">rank:</div>
        <div class="col-sm-1 createdAtCell">Active since:</div>
        <div class="col-sm-1">Due in:</div>
      </b>
    </div>
    <div class="row" ng-repeat="item in items | orderBy: '-rank':true">
<!--                            PRIORITY                               -->
      <div class="col-sm-1 priorityCell cell">
        {{$index + 1}}
      </div>
<!--                            NAME                                   -->
      <div class="col-sm-1 nameCell cell">
        <div class="nameLine" ng-class="{'text': item.q_completed.value}" ng-hide="nameEdit" ng-Mouseover="nameEdit=true" ng-Mouseleave="nameEdit=false">
          {{item.a_text}}
        </div>
        <input class="nameEditBox editBox" type="inputText" ng-show="nameEdit" ng-Mouseover="nameEdit=true" ng-Mouseleave="nameEdit=false" ng-model="item.a_text" ng-change="items.$save(item)"/>
      </div>
<!--                            DATE                                   -->
      <div class="col-sm-1 dateCell cell" ng-class="{'text': item.q_completed.value}">
        <div class="dateLine" ng-class="{'text': item.q_completed.value}" ng-hide="dateNum" ng-Mouseover="dateNum=true" ng-Mouseleave="dateNum=false">
          {{item.b_dueDate | date: 'M/d/yy h:mm a'}}
        </div>
        <input class="dateEditBox editBox" type="datetime-local" ng-show="dateNum" ng-Mouseover="dateNum=true" ng-Mouseleave="dateNum=false" placeholder="yyyy-MM-ddTHH:mm:ss" ng-model="item.b_dueDate" ng-change="items.$save(item)"/>
      </div>
<!--                            IMPORTANCE                             -->
      <div class="col-sm-1 importanceCell cell">
        <div class="importanceLine" ng-class="{'text': item.q_completed.value}" ng-hide="impSelect" ng-Mouseover="impSelect=true" ng-Mouseleave="impSelect=false">
          {{item.p_importance.repeatSelect}}
        </div>
        <select class="importanceEditBox" id="repeatSelect" ng-model="newImportanceTxt.repeatSelect" ng-change="items.$save(item)" ng-show="impSelect" ng-Mouseover="impSelect=true" ng-Mouseleave="impSelect=false"><option ng-repeat="option in newImportanceTxt.availableOptions" value="{{option.text}}">{{option.text}}</option></select>
      </div>
<!--                            URGENT                               -->
      <div class="col-sm-1 urgentCell cell">
        <div class="urgentLine" ng-class="{'text': item.q_completed.value}" ng-hide="urgentEdit" ng-Mouseover="urgentEdit=true" ng-Mouseleave="urgentEdit=false">
          {{item.r_urgent}}
        </div>
        <div class="urgentEditBox editBox" ng-show="urgentEdit" ng-Mouseover="urgentEdit=true" ng-Mouseleave="urgentEdit=false">
          Check if urgent: <input type="checkbox" ng-model="item.r_urgent" ng-change="items.$save(item)" />
        </div>
      </div>
<!--                            DURATION                               -->
      <div class="col-sm-1 numberCell cell">
        <div class="numberLine" ng-class="{'text': item.q_completed.value}" ng-hide="hourEdit" ng-Mouseover="hourEdit=true" ng-Mouseleave="hourEdit=false">
          {{item.o_timeToFinishDate | date: 'H'}}
        </div>
        <input class="numberEditBox editBox" type="number" ng-model="item.m_hoursToFinish"  ng-change="items.$save(item)" ng-show="hourEdit" ng-Mouseover="hourEdit=true" ng-Mouseleave="hourEdit=false"/>
      </div>
      <div class="col-sm-1 numberCell cell">
        <div class="numberLine" ng-class="{'text': item.q_completed.value}" ng-hide="minuteEdit" ng-Mouseover="minuteEdit=true" ng-Mouseleave="minuteEdit=false">
          {{item.o_timeToFinishDate | date: 'm'}}
        </div>
        <input class="numberEditBox editBox" type="number" ng-model="item.n_minutesToFinish"  ng-change="items.$save(item)" ng-show="minuteEdit" ng-Mouseover="minuteEdit=true" ng-Mouseleave="minuteEdit=false"/>
      </div>
<!--                            RANK                                   -->
      <div class="col-sm-1 rankCell cell" ng-class="{'text': item.q_completed.value}">
        {{item.s_rank}}
      </div>
<!--                            DATE CREATED                           -->
      <div class="col-sm-1 createdAtCell cell" ng-class="{'text': item.q_completed.value}">
        {{item.t_created_at | date: 'M/d/yy h:mm a'}}
      </div>
<!--                        TIME TO COMPLETE                           -->
      <div class="col-sm-1">
        <div class="dueCell cell" ng-class="{'text': item.q_completed.value}">
          <span> {{parseTime(item.b_dueDate).year}}yr</span>  <span>{{parseTime(item.b_dueDate).month}}mth</span>
          <span>{{parseTime(item.b_dueDate).day}}days</span> <span>{{parseTime(item.b_dueDate).hour}}hrs</span> <span>{{parseTime(item.b_dueDate).minute}}ms</span> <span>{{parseTime(item.b_dueDate).second}}secs</span>
        </div>
      </div>
<!--                     COMPLETE CHECKBOX + DELETE                    -->

      <div class="col-sm-1 completedBox">
        <input type="checkbox" ng-model="item.q_completed.value" ng-change="items.$save(item)"/>
      </div>
      <div class="col-sm-1 deleteButton" ng-show="item.q_completed.value">
        <button class="btn btn-danger" ng-click="items.$remove(item)">Delete item</button>
      </div>
    </div>
  </div>
  <hr>
      <!-- <div id="chart-1" style="height: 300px;"></div> -->

<!--                            FORM                               -->

        <!-- push a new message onto the array -->
  <form ng-submit="addItem()" class="form">
    <table>
<!--                         name                             -->

      <tr>
        <td>Enter item name:</td>
        <td><input class="col-xs-1 form-control formBox" ng-model="newItemName" /></td>
      </tr>
<!--                            date                               -->
      <tr>
        <td>Enter due date:</td>
        <td>
          <div class="row">
            <div class="col-md-6">
              <p class="input-group formBox">
                <input type="text" class="form-control" uib-datepicker-popup="dd-MMMM-yyyy" ng-model="newDueDate" is-open="popup1.opened" datepicker-options="dateOptions" ng-required="true" close-text="Close" alt-input-formats="altInputFormats" />
                <span class="input-group-btn">
                  <button type="button" class="btn btn-default" ng-click="openDatePicker()"><i class="glyphicon glyphicon-calendar"></i></button>
                </span>
              </p>
            </div>
          </div>
          <div class="row">
            <!-- <div class="col-md-6">
              <label>Format: <span class="muted-text">(manual alternate <em>{{altInputFormats[0]}}</em>)</span></label> <select class="form-control formBox" ng-model="format" ng-options="f for f in formats"><option></option></select>
            </div> -->
          </div>
          <hr/>
          <button type="button" class="btn btn-sm btn-info" ng-click="today()">Today</button>
          <button type="button" class="btn btn-sm btn-danger" ng-click="clear()">Clear</button>
          <!-- <button type="button" class="btn btn-sm btn-default" ng-click="toggleMin()" uib-tooltip="After today restriction">Min date</button>
          <button type="button" class="btn btn-sm btn-default" ng-click="toggleWeekendDisable()" uib-tooltip="weekend restriction">restrict weekends</button> -->
        </td>
      </tr>
<!--                            time                               -->
      <tr>
        <td>Enter due time:</td>
        <td>
          <div class="numberFormBox" uib-timepicker ng-model="newDueTime" ng-change="changed()" hour-step="hstep" minute-step="mstep" show-meridian="ismeridian"></div>
          <pre class="alert alert-info">Time is: {{newDueTime | date: "shortTime"}}</pre>

          <!-- <div class="row">
            <div class="col-xs-6">
                Hours step is:
              <select class="form-control numberFormBox" ng-model="hstep" ng-options="opt for opt in options.hstep"></select>
            </div>
            <div class="col-xs-6">
                Minutes step is:
              <select class="form-control numberFormBox" ng-model="mstep" ng-options="opt for opt in options.mstep"></select>
            </div>
          </div> -->

          <hr>

          <!-- <button type="button" class="btn btn-info" ng-click="toggleMode()">12H / 24H</button> -->
          <button type="button" class="btn btn-default" ng-click="update()">Set to 14:00</button>
          <button type="button" class="btn btn-danger" ng-click="clear()">Clear</button>
        </td>
      </tr>
<!--                            est. time                              -->
      <tr>
        <td>Enter est. time to finish:</td>
        <td><select class="form-control numberFormBox" ng-model="newHourEst" ng-options="opt for opt in timeOptions.hour"></select> hours and <select class="form-control numberFormBox" ng-model="newMinuteEst" ng-options="opt for opt in timeOptions.minute"></select> minutes </td>
      </tr>
<!--                            importance                             -->
      <tr>
        <td>Enter importance:</td>
        <td>
          <select id="repeatSelect" ng-model="newImportanceTxt.repeatSelect" class="form-control formBox">
            <option ng-repeat="option in newImportanceTxt.availableOptions" value="{{option.text}}">{{option.text}}
            </option>
          </select>
        </td>
      </tr>
      <tr>
        <td></td>
        <td><button type="submit" type="button" class="btn btn-primary">Add to-do item</button></td>
      </tr>
    </table>
  </form>

<!--                            Accordion WINDOW                           -->

  <script type="text/ng-template" id="group-template.html">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title" style="color:#fa39c3">
          <a href tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading">
            <span uib-accordion-header ng-class="{'text-muted': isDisabled}">
              {{heading}}
            </span>
          </a>
        </h4>
      </div>
      <div class="panel-collapse collapse" uib-collapse="!isOpen">
        <div class="panel-body" style="text-align: right" ng-transclude></div>
      </div>
    </div>
  </script>

  <uib-accordion close-others="oneAtATime">
    <div uib-accordion-group class="panel-default" heading="Options">
      <label>Format: <span class="muted-text">(manual alternate <em>{{altInputFormats[0]}}</em>)</span></label>
      <select class="form-control formBox" ng-model="format" ng-options="f for f in formats"><option></option></select>
      <button type="button" class="btn btn-sm btn-default" ng-click="toggleMin()" uib-tooltip="After today restriction">Min date</button>
      <button type="button" class="btn btn-sm btn-default" ng-click="toggleWeekendDisable()" uib-tooltip="weekend restriction">restrict weekends</button>
      Hours step is:
      <select class="form-control numberFormBox" ng-model="hstep" ng-options="opt for opt in options.hstep"></select>
      Minutes step is:
      <select class="form-control numberFormBox" ng-model="mstep" ng-options="opt for opt in options.mstep"></select>
      <button type="button" class="btn btn-info" ng-click="toggleMode()">12H / 24H</button>
    </div>
  </uib-accordion>


</section>
